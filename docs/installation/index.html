<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installation | NotifyBC</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="a versatile notification API server">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/NotifyBC/assets/css/0.styles.7904a91c.css" as="style"><link rel="preload" href="/NotifyBC/assets/js/app.cf2e36d6.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/2.55711d2d.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/3.3c76b336.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/35.80eda99a.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/js/10.18f11048.js"><link rel="prefetch" href="/NotifyBC/assets/js/11.4622be60.js"><link rel="prefetch" href="/NotifyBC/assets/js/12.f0bbce48.js"><link rel="prefetch" href="/NotifyBC/assets/js/13.c3161644.js"><link rel="prefetch" href="/NotifyBC/assets/js/14.6830a88e.js"><link rel="prefetch" href="/NotifyBC/assets/js/15.0e5d26db.js"><link rel="prefetch" href="/NotifyBC/assets/js/16.da2caffe.js"><link rel="prefetch" href="/NotifyBC/assets/js/17.504a874b.js"><link rel="prefetch" href="/NotifyBC/assets/js/18.178830db.js"><link rel="prefetch" href="/NotifyBC/assets/js/19.59331130.js"><link rel="prefetch" href="/NotifyBC/assets/js/20.4cc9423c.js"><link rel="prefetch" href="/NotifyBC/assets/js/21.b679eca4.js"><link rel="prefetch" href="/NotifyBC/assets/js/22.509f5528.js"><link rel="prefetch" href="/NotifyBC/assets/js/23.5e7453fc.js"><link rel="prefetch" href="/NotifyBC/assets/js/24.71cb07fd.js"><link rel="prefetch" href="/NotifyBC/assets/js/25.85f7ce9b.js"><link rel="prefetch" href="/NotifyBC/assets/js/26.537b4148.js"><link rel="prefetch" href="/NotifyBC/assets/js/27.06b0c983.js"><link rel="prefetch" href="/NotifyBC/assets/js/28.83f28f0c.js"><link rel="prefetch" href="/NotifyBC/assets/js/29.f1d7dc3e.js"><link rel="prefetch" href="/NotifyBC/assets/js/30.5570a9a6.js"><link rel="prefetch" href="/NotifyBC/assets/js/31.84bc1aef.js"><link rel="prefetch" href="/NotifyBC/assets/js/32.b3e157a9.js"><link rel="prefetch" href="/NotifyBC/assets/js/33.d70df2f1.js"><link rel="prefetch" href="/NotifyBC/assets/js/34.67ac87aa.js"><link rel="prefetch" href="/NotifyBC/assets/js/36.70a9c030.js"><link rel="prefetch" href="/NotifyBC/assets/js/37.71e51666.js"><link rel="prefetch" href="/NotifyBC/assets/js/38.61301c19.js"><link rel="prefetch" href="/NotifyBC/assets/js/39.ec41932f.js"><link rel="prefetch" href="/NotifyBC/assets/js/4.a61309d8.js"><link rel="prefetch" href="/NotifyBC/assets/js/40.0523fc8f.js"><link rel="prefetch" href="/NotifyBC/assets/js/41.f9b934d9.js"><link rel="prefetch" href="/NotifyBC/assets/js/42.74664d00.js"><link rel="prefetch" href="/NotifyBC/assets/js/43.7dae5493.js"><link rel="prefetch" href="/NotifyBC/assets/js/44.0cf7f4f3.js"><link rel="prefetch" href="/NotifyBC/assets/js/5.3c962adf.js"><link rel="prefetch" href="/NotifyBC/assets/js/6.5a29f8a4.js"><link rel="prefetch" href="/NotifyBC/assets/js/7.164f656f.js"><link rel="prefetch" href="/NotifyBC/assets/js/8.bdcf4fb5.js"><link rel="prefetch" href="/NotifyBC/assets/js/9.7ba400ef.js">
    <link rel="stylesheet" href="/NotifyBC/assets/css/0.styles.7904a91c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/NotifyBC/" class="home-link router-link-active"><img src="/NotifyBC/img/logo.svg" alt="NotifyBC" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/NotifyBC/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/f-w/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/NotifyBC/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/f-w/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/" aria-current="page" class="sidebar-link">Welcome</a></li><li><a href="/NotifyBC/docs/overview/" class="sidebar-link">Overview</a></li><li><a href="/NotifyBC/docs/quickstart/" class="sidebar-link">Quick-start guide</a></li><li><a href="/NotifyBC/docs/installation/" aria-current="page" class="active sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotifyBC/docs/installation/#deploy-locally-from-source-code" class="sidebar-link">Deploy Locally from Source Code</a></li><li class="sidebar-sub-header"><a href="/NotifyBC/docs/installation/#deploy-docker-container" class="sidebar-link">Deploy Docker Container</a></li><li class="sidebar-sub-header"><a href="/NotifyBC/docs/installation/#deploy-to-openshift" class="sidebar-link">Deploy to OpenShift</a></li><li class="sidebar-sub-header"><a href="/NotifyBC/docs/installation/#install-docs-website-optional" class="sidebar-link">Install Docs Website (Optional)</a></li></ul></li><li><a href="/NotifyBC/docs/usage/" class="sidebar-link">Basic Usage</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Configuration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/config-overview/" class="sidebar-link">Configuration Overview</a></li><li><a href="/NotifyBC/docs/config-adminIpList/" class="sidebar-link">Admin IP List</a></li><li><a href="/NotifyBC/docs/config-reverseProxyIpLists/" class="sidebar-link">Reverse Proxy IP Lists</a></li><li><a href="/NotifyBC/docs/config-httpHost/" class="sidebar-link">HTTP Host</a></li><li><a href="/NotifyBC/docs/config-smtp/" class="sidebar-link">SMTP</a></li><li><a href="/NotifyBC/docs/config-sms/" class="sidebar-link">SMS</a></li><li><a href="/NotifyBC/docs/config-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/docs/config-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/docs/config-database/" class="sidebar-link">Database</a></li><li><a href="/NotifyBC/docs/config-nodeRoles/" class="sidebar-link">Node Roles</a></li><li><a href="/NotifyBC/docs/config-cronJobs/" class="sidebar-link">Cron Jobs</a></li><li><a href="/NotifyBC/docs/config-rsaKeys/" class="sidebar-link">RSA Keys</a></li><li><a href="/NotifyBC/docs/config-internalHttpHost/" class="sidebar-link">Internal HTTP Host</a></li><li><a href="/NotifyBC/docs/config-inboundSmtpServer/" class="sidebar-link">Inbound SMTP Server</a></li><li><a href="/NotifyBC/docs/config-listUnsubscribeByEmail/" class="sidebar-link">List-unsubscribe by Email</a></li><li><a href="/NotifyBC/docs/config-notificationBounce/" class="sidebar-link">Notification Bounce</a></li><li><a href="/NotifyBC/docs/config-workerProcessCount/" class="sidebar-link">Worker Process Count</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/api-overview/" class="sidebar-link">API Overview</a></li><li><a href="/NotifyBC/docs/api-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/docs/api-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/docs/api-config/" class="sidebar-link">Configuration</a></li><li><a href="/NotifyBC/docs/api-administrator/" class="sidebar-link">Administrator</a></li><li><a href="/NotifyBC/docs/api-bounce/" class="sidebar-link">Bounce</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/benchmarks/" class="sidebar-link">Benchmarks</a></li><li><a href="/NotifyBC/docs/bulk-import/" class="sidebar-link">Bulk Import</a></li><li><a href="/NotifyBC/docs/developer-notes/" class="sidebar-link">Developer Notes</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Meta</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/conduct/" class="sidebar-link">Code of Conduct</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><em>NotifyBC</em> can be installed in 3 ways:</p> <ol><li>deploying locally from source code</li> <li>deploying a Docker container</li> <li>deploying to OpenShift</li></ol> <p>For small-scale production deployment or for evaluation, both source code and docker container will do. For large-scale production deployment that requires horizontal scalability, the recommendation is one of</p> <ul><li>deploying to OpenShift</li> <li>setting up a load banalced app cluster from source code build, backed by mongodb.</li></ul> <p>To setup a development environment in order to contribute to <em>NotifyBC</em>,
installing from source code is preferred.</p> <h2 id="deploy-locally-from-source-code"><a href="#deploy-locally-from-source-code" class="header-anchor">#</a> Deploy Locally from Source Code</h2> <h3 id="system-requirements"><a href="#system-requirements" class="header-anchor">#</a> System Requirements</h3> <ul><li>Software
<ul><li>Git</li> <li><a href="https://nodejs.org" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>@&gt;=6.9.1</li></ul></li> <li>Services
<ul><li>MongoDB, optional but recommended for production</li> <li>A standard SMTP server to deliver outgoing email, optional but recommended for production. You can use an existing organizational shared service, cloud-based service such as Amazon SES, or setting up your own SMTP server</li> <li>A tcp proxy server such as <a href="http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html" target="_blank" rel="noopener noreferrer">nginx stream proxy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> if list-unsubscribe by email is needed and <em>NotifyBC</em> server cannot expose port 25 to internet</li> <li>A SMS service provider account if needs to enable SMS channel. The supported service providers are
<ul><li>Twilio (default)</li></ul></li> <li>SiteMinder, if need to allow authenticated user request</li></ul></li> <li>Network and Permissions
<ul><li>Minimum runtime firewall requirements:
<ul><li>outbound to your ISP DNS server</li> <li>outbound to any on port 80, 443 and 22 in order to run build scripts and send SMS messages</li> <li>outbound to any on SMTP port 25 if using direct mail; for SMTP relay, outbound to your configured SMTP server and port only</li> <li>inbound to listening port (3000 by default)from other authorized server ips</li> <li>if <em>NotifyBC</em> instance will handle anonymous subscription from client browser, the listening port should be open to internet either directly or indirectly through a reverse proxy; If <em>NotifyBC</em> instance will only handle SiteMinder authenticated webapp requests, the listening port should NOT be open to internet. Instead, it should only open to SiteMinder web agent reverse proxy.</li></ul></li> <li>If list-unsubscribe by email is needed, then one of the following must be met
<ul><li><em>NotifyBC</em> can bind to port 25 opening to internet</li> <li>a tcp proxy server of which port 25 is open to internet. This proxy server can reach <em>NotifyBC</em> on a tcp port.</li></ul></li></ul></li></ul> <h3 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h3> <div class="custom-block tip"><p class="custom-block-title">ProTips™ install from behind firewall</p> <p>If you want to install on a server behind firewall which restricts internet connection, you can work around the firewall as long as you have access to a http(s) forward proxy server. Assuming the proxy server is http://my_proxy:8080 which proxies both http and https requests, to use it:</p></div> <p>run following commands</p> <div class="language-sh extra-class"><pre class="language-sh"><code>~ $ <span class="token function">git</span> clone <span class="token punctuation">\</span>
https://github.com/bcgov/MyGovBC-notification-server.git <span class="token punctuation">\</span>
notifyBC
~ $ <span class="token builtin class-name">cd</span> notifyBC
~/notifyBC $ <span class="token function">npm</span> i -g <span class="token function">yarn</span> <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> <span class="token function">install</span>
~/notifyBC $ <span class="token function">npm</span> start
</code></pre></div><p>If successful, you will see following output</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; notification@1.0.0 start .../notification
&gt; node .

...
Web server listening at: http://localhost:3000
</code></pre></div><p>Now browse to <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> the page displays NotifyBC Web Console.</p> <h4 id="install-windows-service"><a href="#install-windows-service" class="header-anchor">#</a> Install Windows Service</h4> <p>After get the app running interactivelly, if your server is Windows and you want to install the app as a Windows service, run</p> <div class="language- extra-class"><pre class="language-text"><code>npm install -g node-windows
npm link node-windows
node 'windows service.js'
</code></pre></div><p>This will create and start service <em>notifyBC</em>. To change service name, modify file <em>windows service.js</em> before running it. See <a href="https://github.com/coreybutler/node-windows" target="_blank" rel="noopener noreferrer">node-windows<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for other operations such as uninstalling the service.</p> <h2 id="deploy-docker-container"><a href="#deploy-docker-container" class="header-anchor">#</a> Deploy Docker Container</h2> <p>If you have git and Docker installed, you can run following command to deploy <em>NotifyBC</em> Docker container:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>~ $ <span class="token function">git</span> clone <span class="token punctuation">\</span>
https://github.com/bcgov/MyGovBC-notification-server.git <span class="token punctuation">\</span>
notifyBC
~ $ <span class="token builtin class-name">cd</span> notifyBC
~ $ docker build -t notify-bc <span class="token builtin class-name">.</span>
~ $ docker run -p <span class="token number">3000</span>:3000 notify-bc
</code></pre></div><p>If successful, similar output is displayed as in source code installation.</p> <h2 id="deploy-to-openshift"><a href="#deploy-to-openshift" class="header-anchor">#</a> Deploy to OpenShift</h2> <p><em>NotifyBC</em> supports deployment to OpenShift Origin of minimum version 1.5, or other compatible platforms such as OpenShift Container Platform of matching version. <a href="https://github.com/bcgov/MyGovBC-notification-server/blob/master/.opensift-templates" target="_blank" rel="noopener noreferrer">OpenShift instant app templates<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> have been created to facilitate build and deployment. This template adopts <a href="https://docs.openshift.org/latest/dev_guide/builds.html#using-secrets-s2i-strategy" target="_blank" rel="noopener noreferrer">source-to-image strategy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with <a href="https://docs.openshift.org/latest/dev_guide/builds.html#binary-source" target="_blank" rel="noopener noreferrer">binary source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> input and supports <a href="https://docs.openshift.org/latest/dev_guide/builds.html#incremental-builds" target="_blank" rel="noopener noreferrer">incremental builds<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>To deploy to OpenShift, you need to have access to relevant OpenShift projects with minimum edit role. This implies you know and have access to OpenShift web console as identified by <em>&lt;openshift-console-url&gt;</em> below.</p> <p>OpenShift is expected to be setup this way:</p> <ul><li>1 project for build. This project is identified by <em>&lt;yourprojectname-tools&gt;</em>  below. All build related activities take place in this project.</li> <li>1 or more projects for runtime environments such as <em>dev</em>, <em>test</em> etc, identified by <em>&lt;yourprojectname-&lt;env&gt;&gt;</em> below. All deployment activities and runtime artifacts are contained in respective projects to make an environment self-sufficient.</li></ul> <p>The deployment can be initiated from localhost or automated by CI service such as Jenkins. Regardless, at the initiator's side following software needs to be installed:</p> <ul><li>git</li> <li><a href="https://docs.openshift.org/latest/cli_reference/index.html" target="_blank" rel="noopener noreferrer">OpenShift CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>If using Jenkins, all the software are pre-installed on OpenShift provided Jenkins instant-app template so it is the preferred CI environment. Instructions below assumes OpenShift Jenkins is used. OpenShift Jenkins should be created in project <em>&lt;yourprojectname-tools&gt;</em>.</p> <h3 id="hosting-environment-setup"><a href="#hosting-environment-setup" class="header-anchor">#</a> Hosting Environment Setup</h3> <ol><li><p>Install the templates</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~ $ <span class="token function">git</span> clone <span class="token punctuation">\</span>
https://github.com/bcgov/MyGovBC-notification-server.git <span class="token punctuation">\</span>
notifyBC
~ $ <span class="token builtin class-name">cd</span> notifyBC
~ $ oc login -u <span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> -p <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>openshift-console-url<span class="token operator">&gt;</span>
~ $ oc create -f .opensift-templates/notify-bc-build.yml -n <span class="token operator">&lt;</span>yourprojectname-tools<span class="token operator">&gt;</span>
~ $ oc create -f .opensift-templates/notify-bc.yml -n <span class="token operator">&lt;</span>yourprojectname-<span class="token operator">&lt;</span>env<span class="token operator">&gt;&gt;</span>
</code></pre></div><p>After this step you will find an instant app template called <em>notify-bc-build</em> available in the <em>&lt;yourprojectname-tools&gt;</em> project and <em>notify-bc</em> in the <em>&lt;yourprojectname-&lt;env&gt;&gt;</em> project.</p> <p>The template <em>notify-bc.yml</em> creates a single instance MongoDB. If you want a 3-node MongoDB cluster, use template <em>notify-bc-mongodb-cluster.yml</em> instead, i.e. replace last command  with</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~ $ oc create -f .opensift-templates/notify-bc-mongodb-cluster.yml -n <span class="token operator">&lt;</span>yourprojectname-<span class="token operator">&lt;</span>env<span class="token operator">&gt;&gt;</span>
</code></pre></div><p>MongoDB cluster created by this template uses stateful sets. As of OpenShift 1.5, stateful set is in technology preview phase so use the feature with precaution.</p></li> <li><p>create OpenShift apps by clicking <em>Add to Project</em> in web console of respective projects, select JavaScript in languages catalog, and click either <em>notify-bc-build</em> or <em>notify-bc</em> template. Adjust parameters as you see fit.</p></li> <li><p>(optional) create instance-specific <a href="/NotifyBC/docs/config-overview/">configuration</a> files by modifying configMap <em>notify-bc</em>. To do so, in web console of a runtime environment project, click <em>Resources &gt; Config Maps &gt; notify-bc &gt; Actions &gt; Edit</em>. Each config file corresponds to an item in configMap with key being the file name. For example, to create config file <em>config.local.json</em>, create an item with key <em>config.local.json</em>.</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">ProTips™ backup config files</p> <p>Backup config files to a private secured SCM outside of OpenShift is highly recommended, especially for production environment.</p></div> <h3 id="build"><a href="#build" class="header-anchor">#</a> Build</h3> <p>To build runtime image manually from localhost, run</p> <div class="language-sh extra-class"><pre class="language-sh"><code>~ $ oc start-build notify-bc --follow --wait --from-dir<span class="token operator">=</span>. -n <span class="token operator">&lt;</span>yourprojectname-tools<span class="token operator">&gt;</span>
</code></pre></div><p>If build is successful, you will find image <em>&lt;yourprojectname-tools&gt;/notify-bc:latest</em> is updated.</p> <p>To initiate the build from Jenkins, create a new Freestyle project. Set <em>Source Code Management</em> to Git repository https://github.com/bcgov/MyGovBC-notification-server.git and add a <em>Execute Shell</em> build step with the command.</p> <p>Proper authorization is needed for Jenkins to access OpenShift. The service account used by Jenkins has to be granted edit role in all projects by running</p> <div class="language-sh extra-class"><pre class="language-sh"><code>~ $ oc policy add-role-to-user edit <span class="token punctuation">\</span>
system:serviceaccount:<span class="token operator">&lt;</span>yourprojectname-tools<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>jenkins-service-name<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
-n <span class="token operator">&lt;</span>yourprojectname-tools<span class="token operator">&gt;</span>
~ $ oc policy add-role-to-user edit <span class="token punctuation">\</span>
system:serviceaccount:<span class="token operator">&lt;</span>yourprojectname-tools<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>jenkins-service-name<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
-n <span class="token operator">&lt;</span>yourprojectname-<span class="token operator">&lt;</span>env<span class="token operator">&gt;&gt;</span>
</code></pre></div><p>replace <em>&lt;jenkins-service-name&gt;</em> with the jenkins service name. In some editions of OpenShift, <em>&lt;jenkins-service-name&gt;</em> is fixed to <em>default</em>. To find exact Jenkins service account, add following line to Jenkins shell build step and inspect its build output</p> <div class="language-sh extra-class"><pre class="language-sh"><code>oc <span class="token function">whoami</span>
</code></pre></div><h3 id="deploy"><a href="#deploy" class="header-anchor">#</a> Deploy</h3> <p>Deployment is achieved through image tagging. This guarantees the image deployed to different runtime environments are binary identical. To deploy manually from localhost, run</p> <div class="language-sh extra-class"><pre class="language-sh"><code>~ $ oc tag <span class="token operator">&lt;</span>yourprojectname-tools<span class="token operator">&gt;</span>/notify-bc:latest <span class="token operator">&lt;</span>yourprojectname-<span class="token operator">&lt;</span>env<span class="token operator">&gt;&gt;</span>/notify-bc:latest
</code></pre></div><p>If the deployment is successful, you can launch <em>NotifyBC</em> from the URL provided in <em>&lt;yourprojectname-&lt;env&gt;&gt;</em> project.</p> <p>To initiate the deployment from Jenkins, add the above command to the build command in Jenkins.</p> <h3 id="change-propagation"><a href="#change-propagation" class="header-anchor">#</a> Change Propagation</h3> <p>To promote runtime image from one environment to another, for example from <em>dev</em> to <em>test</em>, run</p> <div class="language- extra-class"><pre class="language-text"><code>oc tag &lt;yourprojectname-tools&gt;/notify-bc:latest &lt;yourprojectname-test&gt;/notify-bc:latest &lt;yourprojectname-tools&gt;/notify-bc:test
</code></pre></div><p>The above command will deploy the latest (which should also be dev) runtime image to <em>test</em> env. The purpose of tagging runtime image of <em>test</em> env in both &lt;yourprojectname-test&gt;/notify-bc:latest and &lt;yourprojectname-tools&gt;/notify-bc:test is to use &lt;yourprojectname-tools&gt;/notify-bc:test as backup such that in case the image stream &lt;yourprojectname-test&gt;/notify-bc, which is used by <em>test</em> runtime pods, is deleted inadvertently, it can be recovered from &lt;yourprojectname-tools&gt;/notify-bc:test.</p> <h2 id="install-docs-website-optional"><a href="#install-docs-website-optional" class="header-anchor">#</a> Install Docs Website (Optional)</h2> <p>If you want to contribute to <em>NotifyBC</em> docs beyond simple fix ups, you can install <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> through Ruby bundler and render this web site locally:</p> <ol><li>Install <a href="https://www.ruby-lang.org/en/documentation/installation/" target="_blank" rel="noopener noreferrer">Ruby<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Run</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> /docs
gem <span class="token function">install</span> bundler
bundle <span class="token function">install</span>
bundle <span class="token builtin class-name">exec</span> jekyll serve
</code></pre></div><p>If everything goes well, you will get output:</p> <div class="language- extra-class"><pre class="language-text"><code>Configuration file: .../notifyBC/docs/_config.yml
            Source: .../notifyBC/docs
       Destination: .../notifyBC/docs/_site
 Incremental build: disabled. Enable with --incremental
      Generating...
                    done in 3.971 seconds.
 Auto-regeneration: enabled for '.../notifyBC/docs'
Configuration file: .../notifyBC/docs/_config.yml
    Server address: http://127.0.0.1:4000/MyGovBC-notification-server/
  Server running... press ctrl-c to stop.
</code></pre></div><p>You can now browse to the local docs site <a href="http://127.0.0.1:4000/MyGovBC-notification-server/" target="_blank">http://127.0.0.1:4000/MyGovBC-notification-server/</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NotifyBC/docs/quickstart/" class="prev">
        Quick-start guide
      </a></span> <span class="next"><a href="/NotifyBC/docs/usage/">
        Basic Usage
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/NotifyBC/assets/js/app.cf2e36d6.js" defer></script><script src="/NotifyBC/assets/js/2.55711d2d.js" defer></script><script src="/NotifyBC/assets/js/3.3c76b336.js" defer></script><script src="/NotifyBC/assets/js/35.80eda99a.js" defer></script>
  </body>
</html>
